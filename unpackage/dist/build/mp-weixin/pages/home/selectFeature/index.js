(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/home/selectFeature/index"],{"0557":function(e,t,n){},1844:function(e,t,n){"use strict";var r=function(){var e=this,t=e.$createElement,n=(e._self._c,e.__map(e.features,function(t,n){var r=e._getFeatureText(t);return{$orig:e.__get_orig(t),m0:r}}));e.$mp.data=Object.assign({},{$root:{l0:n}})},a=[];n.d(t,"a",function(){return r}),n.d(t,"b",function(){return a})},5155:function(e,t,n){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=c(n("a34a")),a=n("db83"),u=n("f221");function c(e){return e&&e.__esModule?e:{default:e}}function o(e,t,n,r,a,u,c){try{var o=e[u](c),i=o.value}catch(s){return void n(s)}o.done?t(i):Promise.resolve(i).then(r,a)}function i(e){return function(){var t=this,n=arguments;return new Promise(function(r,a){var u=e.apply(t,n);function c(e){o(u,r,a,c,i,"next",e)}function i(e){o(u,r,a,c,i,"throw",e)}c(void 0)})}}var s=wx.cloud.database(),f=s.collection("UserInfo"),l=s.collection("UserCount"),d=s.collection("AllName"),h=(s.command,{onShow:function(){},data:function(){return{gender:"ç”·",noChanceModal:!1,name:[],luckyNames:[],features:u.features}},computed:{bgColor:function(){return"boy"==this.$store.getters.selectGender?"rgba(119,157,202,.3)":"rgba(244,175,196,.5)"},selectFeature:function(){var e=this.features.filter(function(e){return e.selected}).map(function(e){return e.text});return e}},methods:{_getFeatureText:function(e){var t=e["text_"+this._i18n.locale];return t},clickFeature:function(e){var t=this.features.filter(function(e){return e.selected});0==this.features[e].selected&&3==t.length||(this.features[e].selected=!this.features[e].selected)},go:function(){var t=i(r.default.mark(function t(){var n,u;return r.default.wrap(function(t){while(1)switch(t.prev=t.next){case 0:if(this.$store.getters.canGenName){t.next=3;break}return this.noChanceModal=!0,t.abrupt("return");case 3:if(0!=this.selectFeature.length){t.next=5;break}return t.abrupt("return");case 5:return t.next=7,this._getThreeName();case 7:n=t.sent,u={openId:this.$store.getters.openId,createTime:(0,a.formatTime)(new Date),selectFeature:this.selectFeature,selectGender:this.$store.getters.selectGender,luckyName:n},Promise.all([this._addCount(),this._addName(u)]).then(function(t){e.hideLoading(),e.switchTab({url:"/pages/history/index"})});case 10:case"end":return t.stop()}},t,this)}));function n(){return t.apply(this,arguments)}return n}(),_addCount:function(){l.where({_openid:this.$store.getters.openId}).get().then(function(e){var t=e.data[0],n=t.count,r=(t.isShared,t._id);l.doc(r).update({data:{count:n+1}}).then()})},_addName:function(e){f.add({data:e})},_getName_old:function(){var e=[];e="boy"==this.$store.getters.selectGender?this.name.boys:this.name.girls;var t=this.features.filter(function(e){return e.selected}).map(function(e){return e.text});return e=e.filter(function(e){var n=!0;return n=t.some(function(t){return e.characteristics&&e.characteristics.toLowerCase().indexOf(t.toLowerCase())>=0}),n}),e.sort(function(e,t){return Math.random()>.5?-1:1}),e},_getName:function(){var e=i(r.default.mark(function e(t){var n,a,u;return r.default.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return s.command.aggregate,n="",t.forEach(function(e){n+="(?=.*".concat(e,")")}),n+="^.*$",e.next=6,d.aggregate().match({gender:this.$store.getters.selectGender,characteristics:s.RegExp({regexp:n,options:"i"})}).sample({size:3}).end();case 6:return a=e.sent,u=a.list,e.abrupt("return",u);case 9:case"end":return e.stop()}},e,this)}));function t(t){return e.apply(this,arguments)}return t}(),_getThreeName:function(){var e=i(r.default.mark(function e(){var t,n,a=this;return r.default.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this._getName(this.selectFeature);case 2:if(t=e.sent,!(t.length<3)){e.next=8;break}return n=[],u.features.forEach(function(e){n.push(a._getName([e]))}),e.next=8,Promise.all(n).then(function(e){var n=Array.from(new Set(e.flat(1/0))).sort(function(e,t){return Math.random()>.5?-1:1});n.forEach(function(e){var n=function(){return t.some(function(t){return t.name===e.name})};t.length<3&&!n()&&t.push(e)})});case 8:return e.abrupt("return",t);case 9:case"end":return e.stop()}},e,this)}));function t(){return e.apply(this,arguments)}return t}(),hideModal:function(){this.noChanceModal=!1}}});t.default=h}).call(this,n("543d")["default"])},"5bc3":function(e,t,n){"use strict";n.r(t);var r=n("1844"),a=n("6112");for(var u in a)"default"!==u&&function(e){n.d(t,e,function(){return a[e]})}(u);n("ab7c"),n("cd55");var c=n("2877"),o=Object(c["a"])(a["default"],r["a"],r["b"],!1,null,"0721e6e0",null);t["default"]=o.exports},"5e4c":function(e,t,n){"use strict";(function(e){n("005e"),n("921b");r(n("66fd"));var t=r(n("5bc3"));function r(e){return e&&e.__esModule?e:{default:e}}e(t.default)}).call(this,n("543d")["createPage"])},6112:function(e,t,n){"use strict";n.r(t);var r=n("5155"),a=n.n(r);for(var u in r)"default"!==u&&function(e){n.d(t,e,function(){return r[e]})}(u);t["default"]=a.a},ab7c:function(e,t,n){"use strict";var r=n("0557"),a=n.n(r);a.a},cd55:function(e,t,n){"use strict";var r=n("d230"),a=n.n(r);a.a},d230:function(e,t,n){}},[["5e4c","common/runtime","common/vendor"]]]);